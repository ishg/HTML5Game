$(document).ready(function(){function v(){t.clearRect(0,0,n,r);t.fillStyle="blue";t.font="50px Georgia";t.textAlign="center";t.fillText("Bows",n/2,r/2-100);t.fillStyle="green";t.fillText("And",n/2,r/2-50);t.fillStyle="red";t.fillText("Balloons",n/2,r/2);t.fillStyle="black";t.font="25px Calibri";t.fillText("Arrow Keys to Move",n/2,r/2+80);t.fillText("Mouse to Shoot",n/2,r/2+120)}function b(e){e.active=true;e.xVelocity=e.xSpeed;e.yVelocity=-e.ySpeed;e.width=3;e.height=3;e.color="#000";e.inBounds=function(){return e.x>=0&&e.x<=n&&e.y>=0&&e.y<=r};e.draw=function(){t.fillStyle=this.color;t.fillRect(this.x,this.y,this.width,this.height)};e.update=function(){e.x+=e.xVelocity;e.y+=e.yVelocity;e.yVelocity+=i;e.active=e.active&&e.inBounds()};return e}function w(e){e=e||{};e.active=true;e.age=Math.floor(Math.random()*128);e.explosion=10;e.exploding=false;e.color="#FF0000";e.x=n/4+Math.random()*n/2;e.y=0;e.xVelocity=0;e.yVelocity=s;e.width=32;e.height=32;e.inBounds=function(){return e.x>=0&&e.x<=n&&e.y>=0&&e.y<=r};var i=Math.random();if(i<.25){e.sprite=Sprite("red_balloon")}else if(i<.5){e.sprite=Sprite("blue_balloon")}else if(i<.75){e.sprite=Sprite("green_balloon")}else{e.sprite=Sprite("yellow_balloon")}e.draw=function(){this.sprite.draw(t,this.x,this.y)};e.explode=function(){e.exploding=true;e.sprite=Sprite("black_balloon")};e.update=function(){if(!e.exploding){e.x+=e.xVelocity;e.y+=e.yVelocity;e.xVelocity=3*Math.sin(e.age*Math.PI/64);e.age++}else{if(e.explosion>=0){e.explosion-=1}else{this.active=false}}e.active=e.active&&e.inBounds()};return e}function E(e,t){return e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.y+e.height>t.y}function S(){y.forEach(function(e){enemies.forEach(function(t){if(E(e,t)){t.explode();e.active=false;m.score+=1}})});enemies.forEach(function(e){if(E(e,g)){e.explode();g.explode()}else if(e.y+1>r){m.score-=1}})}function x(){if(keydown.left){g.x-=5}if(keydown.right){g.x+=5}g.x=g.x.clamp(0,n-g.width);y.forEach(function(e){e.update()});y=y.filter(function(e){return e.active});enemies.forEach(function(e){e.update()});enemies=enemies.filter(function(e){return e.active});if(m.score==10){s=5;o=.95;m.level=2;m.levelup=true}else if(m.score==20){s=7;o=.9;m.level=3;m.levelup=true}else if(m.score==30){s=9;o=.8;m.level=4;m.levelup=true}else if(m.score==40){s=11;o=.7;m.level=5;m.levelup=true}if(Math.random()>o){enemies.push(w())}S()}function T(){e.width=e.width;h.draw(t,0,0);g.draw();g.drawTurret();y.forEach(function(e){e.draw()});enemies.forEach(function(e){e.draw()});m.draw()}function C(){refreshIntervalId=setInterval(function(){x();T();if(m.gameover==1){t.clearRect(0,0,n,r);t.fillStyle="blue";t.font="50px Georgia";t.textAlign="center";t.fillText("Game Over!",n/2,r/2);t.fillStyle="green";t.font="25px Calibri";t.fillText("Score: "+m.score,n/2,r/2+40);c.prop("disabled",false);c.html("Play Again");if(m.score>m.highscore){m.highscore=m.score}}},1e3/N)}var e=$("#canvas")[0];var t=e.getContext("2d");var n=450,r=450;var i=1,s=3,o=.96;var u=30,a=40,f=40,l=10;var c=$(".btn");var h=Sprite("background");var p;var d;$(document).mousemove(function(e){p=e.pageX;d=e.pageY});v();var m={x:10,y:20,level:1,height:40,width:100,score:0,highscore:0,gameover:0,levellingup:7,levelup:false,draw:function(){t.fillStyle="yellow";t.font="bold 15px Calibri";t.fillText("Level:"+this.level,this.x,this.y);t.fillText("Score:"+this.score,this.x,this.y+20);t.fillText("High Score: "+this.highscore,this.x,this.y+40);if(this.levelup){if(this.levellingup>=0){t.font="bold 30px Calibri";t.textAlign="center";t.fillText("Level "+this.level+"!",n/2,r/2);this.levellingup-=1}else{this.levelup=false;this.levellingup=7}}}};var g={color:"#000",width:32,height:32,x:n/2-u/2,y:r-f,draw:function(){t.fillStyle=this.color;t.fillRect(this.x,this.y,this.width,this.height)},drawTurret:function(){var e=g.midpoint();if(d<=e.y-this.height/2){t.beginPath();t.moveTo(e.x,e.y-this.height/2);t.lineTo(p,d);t.strokeStyle="silver";t.stroke();t.beginPath();t.moveTo(p-5,d);t.lineTo(p+5,d);t.moveTo(p,d+5);t.lineTo(p,d-5);t.strokeStyle="silver";t.lineWidth=1;t.stroke();var n=Math.abs(e.y-this.height/2-d),r=Math.abs(p-e.x),i=Math.atan2(n,r),s=20*Math.cos(i),o=20*Math.sin(i),u=e.y-this.height/2-o,a=0;if(p>=e.x){a=e.x+s}else{a=e.x-s}t.beginPath();t.moveTo(e.x,e.y-this.height/2);t.lineWidth=10;t.lineCap="round";t.lineTo(a,u);t.strokeStyle="#458B00";t.stroke()}else{t.moveTo(e.x,e.y-this.height/2);t.lineTo(p,e.y-this.height/2);t.strokeStyle="silver";t.stroke();t.beginPath();t.moveTo(e.x,e.y-this.height/2);t.lineWidth=10;t.lineCap="round";if(p>=e.x){t.lineTo(e.x+20,e.y-this.height/2)}else{t.lineTo(e.x-20,e.y-this.height/2)}t.strokeStyle="#458B00";t.stroke()}}};$("#canvas").click(function(){g.shoot()});var y=[];enemies=[];g.explode=function(){this.active=false;clearInterval(refreshIntervalId);m.gameover=1};g.shoot=function(){var e=this.midpoint();var t=Math.abs(e.y-this.height/2-d),n=Math.abs(e.x-p),r=Math.sqrt(t*t+n*n),i=Math.atan2(t,n);var s=r/10;var o=s*Math.sin(i);var u=s*Math.cos(i);if(p>=e.x){u=u}else{u=-u}y.push(b({xSpeed:u,ySpeed:o,x:e.x,y:e.y-this.height/2}))};g.midpoint=function(){return{x:this.x+this.width/2,y:this.y+this.height/2}};var N=30;c.click(function(){if(m.gameover==0){c.prop("disabled",true);C()}else{m.gameover=0;m.score=0;enemies.length=0;y.length=0;c.prop("disabled",true);s=4;C()}})})